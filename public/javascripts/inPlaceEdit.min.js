(function(a){function j(c){var b=c.find("span.original"),d=b.text(),e=c.find("span.edit"),f=e.find("form"),g=e.find(':input[type!="hidden"]');b.hide();e.show();g.val(d);g.focus().select();g.bind("keydown",function(h){h=h.keyCode?h.keyCode:h.which;switch(h){case 13:a.ajax({url:f[0].action,type:"PUT",data:f.serialize(),dataType:"json",success:function(i){if(i.success){b.text(i.new_value);e.hide();b.show()}else a("#error_messages").show().html(i.msg[0])},error:function(){a("#error_messages").show().html("Some other error")}}); g.unbind("keydown");break;case 27:e.hide();b.show();g.unbind("keydown");break}});g.blur(function(){e.hide();b.show();a("#error_messages").html("").hide();g.unbind("keydown")})}function k(c){var b=c.prevAll("td").size()+1,d=c.closest('tr:not("tr:has(th)")').next('tr:not("tr:has(th)")');return d.size()>0?d.children("td:nth-child("+b+")"):c}function l(c){var b=c.prevAll("td").size()+1,d=c.closest('tr:not("tr:has(th)")').prev('tr:not("tr:has(th)")');return d.size()>0?d.children("td:nth-child("+b+")"): c}function m(c){var b=c.prevAll("td.editable");b=b.size();return b>0?c.prev():c}function n(c){var b=c.nextAll("td.editable");return b.size()>0?c.next():c}a.fn.inPlaceEdit=function(c){var b=a.extend({},a.fn.inPlaceEdit.defaults,c),d=a(this),e=a("td."+b.editable+":first",d);e.addClass(b.selected);d.data("selected",e);a("td."+b.editable,d).each(function(){a(this).bind("click",function(){a(this).focus();j(a(this))});a(this).bind("focus",function(){d.data("selected").blur();a(this).addClass(b.selected); var f=a(window).scrollTop(),g=f+a(window).height(),h=a(this).offset().top,i=h+a(this).height();if(f>h)a(window).scrollTop(h);else g<i&&a(window).scrollTop(i-a(window).height());d.data("selected",a(this));return a(this)});a(this).bind("blur",function(){a(this).removeClass(b.selected)})});a(document).bind("keydown",function(f){var g=f.keyCode?f.keyCode:f.which;if(e=d.data("selected"))switch(g){case 13:f.preventDefault();j(d.data("selected"));break;case 38:f.preventDefault();l(e).focus();break;case 40:f.preventDefault(); k(e).focus();break;case 37:f.preventDefault();m(e).focus();break;case 39:f.preventDefault();n(e).focus();break}})};a.fn.inPlaceEdit.defaults={selected:"selected",editable:"editable"}})(jQuery);